%jpegencodeå‡½æ•°ç”¨æ¥å‹ç¼©å›¾åƒç”¨ä¸€ç§è¿‘ä¼¼çš„JPEGæ–¹æ³•
function res=jpegencode(x,quality)
    %x ä¸ºè¾“å…¥å›¾åƒ?
    %qualityå†³å®šäº†æˆªå»çš„ç³»æ•°å’Œå‹ç¼©æ¯”
    error(nargchk(1,2,nargin));           %æ£?æŸ¥è¾“å…¥å‚æ•?
    if nargin<2
        quality=1;                        %ç¼ºçœçš„quality=1
    end
    x=double(x)-128;                      %åƒç´ å±‚æ¬¡ç§»åŠ¨-128
    [xm,xn]=size(x);                      %å¾—åˆ°å›¾åƒçš„å°ºå¯?
    t=dctmtx(8);                          %å¾—åˆ°8*8DCTå˜æ¢çŸ©é˜µ
    %å°†å›¾åƒåˆ†å‰²æˆ8*8å­å›¾åƒ?,è¿›è¡ŒDCTå˜æ¢,ç„¶åè¿›è¡Œé‡åŒ–
    y=blkproc(x,[8 8],'dct2(x)') %            'P1*x*P2',t,t');
    m=[16 11 10 16 24 40 51 61            %JEPGæ ‡å‡†åŒ–çŸ©é˜?
        12 12 14 19 26 58 60 55
        14 13 16 24 40 57 69 56
        14 17 22 29 51 87 80 62
        18 22 37 56 68 109 103 77
        24 35 55 64 81 104 113 92
        49 64 78 87 103 121 120 101
        72 92 95 98 112 100 103 99]*quality;
     %ç”¨mæ ‡å‡†åŒ–é˜µåˆ—å¯¹å˜æ¢é˜µåˆ—è¿›è¡Œé‡åŒ–,å³æ ¹æ®å¼(    )æ ‡å‡†åŒ?
    yy=blkproc(y,[8 8],'round(x./P1)',m);  
    y=im2col(yy,[8 8],'distinct');               %å°†å›¾åƒå—æ’åˆ—æˆå‘é‡?
    xb=size(y,2);                                %å¾—åˆ°åˆ—æ•°,ä¹Ÿå°±å­å›¾åƒä¸ªæ•?
    order=[1 9 2 3 10 17 25 18 11 4 5 12 19 26 33 ... %å˜æ¢ç³»æ•°æ’åˆ—æ¬¡åº
        41 34 27 20 13 6 7 14 21 28 35 42 49 57 50 ...
        43 36 29 22 15 8 16 23 30 37 44 51 58 59 52 ... 
       45 38 31 24 32 39 46 53 60 61 54 47 40 48 55 62 63 56 64];
    %ç”¨Zå½¢æ¨¡æ¿å¯¹å˜æ¢ç³»æ•°é‡æ–°æ’åˆ—
    y=y(order,:);
    eob=max(x(:))+1;                             %åˆ›å»ºä¸?ä¸ªå—ç»“æŸç¬¦å·    
    num=numel(y)+size(y,2);
    r=zeros(num,1);
    count=0;
    %å°†éé›¶å…ƒç´ é‡æ–°æ’åˆ—æ”¾å…¥rä¸?.-26 -3   eob  -25    1  eob
    for j=1:xb                               %æ¯æ¬¡å¯¹ä¸€åˆ?(å³ä¸€å?)è¿›è¡Œæ“ä½œ
        i=max(find(y(:,j)));                 %æ‰¾æœ€åä¸€ä¸ªéé›¶å…ƒç´?
        if isempty(i)                        %æ²¡æœ‰éé›¶å…ƒç´ 
            i=0;
        end
        p=count+1;
        q=p+i;
        r(p:q)=[y(1:i,j);eob];               %æˆªå»0 å¹¶åŠ ä¸Šç»“æŸç¬¦å?
        count=count+i+1;              
    end
    r((count+1):end)=[];                      %åˆ é™¤æ²¡æœ‰ç”¨çš„éƒ¨åˆ†
    
    r=r+128;               
    %ä¿å­˜ç¼–ç ä¿¡æ¯
    res.size=uint16([xm,xn]);
    res.numblocks=uint16(xb);
    res.quality=uint16(quality*100);
    %å¯¹rè¿›è¡Œhuffmanç¼–ç 
    [res.huffman res.info]=huffencode(uint8(r));
    